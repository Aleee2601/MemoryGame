<UserControl x:Class="MemoryGame.Views.GameView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MemoryGame.Views"
             xmlns:converters="clr-namespace:MemoryGame.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Styles/Styles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <converters:PathToImageSourceConverter x:Key="PathToImageSourceConverter"/>
            <converters:ColorToSolidBrushConverter x:Key="ColorToSolidBrushConverter"/>
            <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="{StaticResource PrimaryBrush}" Foreground="White" FontSize="14">
            <MenuItem Header="File" Foreground="White">
                <MenuItem Header="Category">
                    <MenuItem Header="Animals" Command="{Binding SelectCategoryCommand}" CommandParameter="Animals"/>
                    <MenuItem Header="Nature" Command="{Binding SelectCategoryCommand}" CommandParameter="Nature"/>
                    <MenuItem Header="Food" Command="{Binding SelectCategoryCommand}" CommandParameter="Food"/>
                </MenuItem>
                <MenuItem Header="New Game" Command="{Binding NewGameCommand}"/>
                <MenuItem Header="Open Game">
                    <MenuItem.Icon>
                        <Image Source="/Resources/Images/open.png" Width="16" Height="16"/>
                    </MenuItem.Icon>
                    <ComboBox Width="150" ItemsSource="{Binding SavedGames}" SelectedItem="{Binding SelectedSavedGame}"/>
                    <Button Content="Open" Command="{Binding OpenGameCommand}" Margin="5"/>
                </MenuItem>
                <MenuItem Header="Save Game" Command="{Binding SaveGameCommand}"/>
                <MenuItem Header="Statistics" Command="{Binding StatisticsCommand}"/>
                <Separator/>
                <MenuItem Header="Exit" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="Options" Foreground="White">
                <MenuItem Header="Standard" IsCheckable="True" IsChecked="{Binding IsStandardSize}"/>
                <MenuItem Header="Custom" IsCheckable="True" IsChecked="{Binding IsCustomSize}"/>
                <Separator/>
                <MenuItem Header="Game Time">
                    <StackPanel Orientation="Horizontal" Margin="5">
                        <TextBox Width="30" Text="{Binding Minutes, UpdateSourceTrigger=PropertyChanged}"/>
                        <TextBlock Text=":" VerticalAlignment="Center" Margin="5,0"/>
                        <TextBox Width="30" Text="{Binding Seconds, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="Help" Foreground="White">
                <MenuItem Header="About" Command="{Binding AboutCommand}"/>
            </MenuItem>
        </Menu>
        
        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Game Controls -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Game Setup Controls -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" 
                            Visibility="{Binding CurrentGame, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=invert}">
                    <StackPanel Margin="0,0,20,0" Visibility="{Binding IsCustomSize, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Rows:" Margin="0,0,5,5"/>
                        <ComboBox Width="60" Style="{StaticResource ModernComboBox}" SelectedItem="{Binding Rows}">
                            <ComboBoxItem Content="2"/>
                            <ComboBoxItem Content="3"/>
                            <ComboBoxItem Content="4"/>
                            <ComboBoxItem Content="5"/>
                            <ComboBoxItem Content="6"/>
                        </ComboBox>
                    </StackPanel>
                    
                    <StackPanel Margin="0,0,20,0" Visibility="{Binding IsCustomSize, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Columns:" Margin="0,0,5,5"/>
                        <ComboBox Width="60" Style="{StaticResource ModernComboBox}" SelectedItem="{Binding Columns}">
                            <ComboBoxItem Content="2"/>
                            <ComboBoxItem Content="3"/>
                            <ComboBoxItem Content="4"/>
                            <ComboBoxItem Content="5"/>
                            <ComboBoxItem Content="6"/>
                        </ComboBox>
                    </StackPanel>
                    
                    <StackPanel Margin="0,0,20,0">
                        <TextBlock Text="Category:" Margin="0,0,5,5"/>
                        <ComboBox Width="120" Style="{StaticResource ModernComboBox}" 
                                  ItemsSource="{Binding Categories}" SelectedItem="{Binding SelectedCategory}"
                                  DisplayMemberPath="Name"/>
                    </StackPanel>
                    
                    <!--<Button Content="Start New Game" Style="{StaticResource PrimaryButton}" 
                            Command="{Binding NewGameCommand}" VerticalAlignment="Bottom"/>-->
                    <Button Content="Start Game"
                                Command="{Binding NewGameCommand}"
                                IsEnabled="{Binding Path=NewGameCommand.CanExecute, Mode=OneWay}" />        

                </StackPanel>
                
                <!-- Timer Display -->
                <Border Grid.Column="1" Background="White" BorderBrush="#dfe6e9" BorderThickness="1" 
                        CornerRadius="4" Padding="15,8" Visibility="{Binding CurrentGame, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBlock Text="{Binding TimeDisplay}" FontSize="20" FontWeight="Bold" Foreground="{StaticResource TextBrush}"/>
                </Border>
                
                <!-- Game Controls -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right"
                            Visibility="{Binding CurrentGame, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Button Content="Save Game" Style="{StaticResource OutlineButton}" Margin="0,0,10,0"
                            Command="{Binding SaveGameCommand}"/>
                    <Button Content="Exit Game" Style="{StaticResource DangerButton}" 
                            Command="{Binding ExitCommand}"/>
                </StackPanel>
            </Grid>

            <!-- Game Board -->
            <Border Grid.Row="1" Style="{StaticResource CardStyle}" 
                    Visibility="{Binding CurrentGame, Converter={StaticResource BooleanToVisibilityConverter}}">
                <ItemsControl ItemsSource="{Binding Cards}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Rows="{Binding Rows}" Columns="{Binding Columns}"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Style="{StaticResource MemoryCardStyle}"
                            Command="{Binding DataContext.CardClickCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                            CommandParameter="{Binding}">
                                <Image Source="{Binding DisplayImage, Converter={StaticResource PathToImageSourceConverter}}"
                               Width="80" Height="80" Stretch="UniformToFill"/>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Border>


            <!-- Welcome Screen -->
            <Border Grid.Row="1" Style="{StaticResource CardStyle}" 
                    Visibility="{Binding CurrentGame, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=invert}">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock Text="Welcome to Memory Game!" FontSize="28" FontWeight="Bold" 
                               Foreground="{StaticResource TextBrush}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Select a category and click 'Start New Game' to begin" FontSize="16" 
                               Foreground="{StaticResource LightTextBrush}" HorizontalAlignment="Center" Margin="0,10,0,30"/>
                    <Image Source="/Resources/Images/logo.png" Width="200" Height="200" Margin="0,0,0,30"/>
                    <Button Content="Start New Game" Style="{StaticResource PrimaryButton}" 
                            Command="{Binding NewGameCommand}" HorizontalAlignment="Center" Padding="20,10"/>
                </StackPanel>
            </Border>
            
            <!-- Game Over Overlay -->
            <Border Grid.Row="1" Background="#80000000" 
                    Visibility="{Binding IsGameOver, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Border Style="{StaticResource CardStyle}" Width="300" Height="200" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Game Over!" FontSize="24" FontWeight="Bold" Foreground="{StaticResource TextBrush}" 
                                   HorizontalAlignment="Center" Margin="0,0,0,10"/>
                        <TextBlock Text="You Won!" FontSize="20" Foreground="{StaticResource SecondaryBrush}" FontWeight="SemiBold"
                                   HorizontalAlignment="Center" Margin="0,0,0,20"
                                   Visibility="{Binding IsGameWon, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <TextBlock Text="You Lost!" FontSize="20" Foreground="{StaticResource AccentBrush}" FontWeight="SemiBold"
                                   HorizontalAlignment="Center" Margin="0,0,0,20"
                                   Visibility="{Binding IsGameWon, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=invert}"/>
                        <Button Content="New Game" Style="{StaticResource PrimaryButton}" 
                                Command="{Binding NewGameCommand}" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Border>
        </Grid>
    </Grid>
</UserControl>
